"use strict";(self.webpackChunkmantis_material_react=self.webpackChunkmantis_material_react||[]).push([[2837],{42837:function(e,t,o){o.r(t),o.d(t,{default:function(){return W}});var r=o(1413),a=o(74165),n=o(15861),s=o(29439),i=o(47313),c=o(19860),l=o(94469),d=o(89600),u=o(81404),f=o(78925),h=o(48737),p=o(73842),g=(o(18654),o(70816)),m=o.n(g),v=function(e,t,o,r){var a=e,n=t,s=o,c=r;console.log("raw data",a),console.log("data from monday",c);var l=(0,i.useMemo)((function(){var e=[];return a&&a.forEach((function(t,o){var r=[],i=[];Array.isArray(n)&&n.forEach((function(e,t){var o,a={position_code:e.position_code,position_name:e.position_name,profile:null===(o=e.Profiles)||void 0===o?void 0:o.map((function(e){return e.user_id}))};r.push(a)})),console.log("positionrows",r),Array.isArray(s)&&s.forEach((function(e,t){var o={total:e.total,timesheet_user:e.created_by,timesheetworkid:e.work_id};i.push(o)})),console.log("timesheetrows",i);var l=function(e){for(var t=0,o=0;o<e.length;o++)console.log("int",e[o]),t+=parseInt(e[o]),console.log("int sum",t);return isNaN(t)?0:t};if(a.length>0){var d={project_id:t.project_id,client_id:t.client_id,project_code:t.project_code,project_name:t.project_name,created_date:t.created_date,start_date:m()(t.start_date).format("DD-MM-YYYY"),finish_date:m()(t.finish_date).format("DD-MM-YYYY"),due_date:m()(t.due_date).format("DD-MM-YYYY"),is_active:t.is_active,is_deleted:t.is_deleted,work_id:t.Works.map((function(e){return e.work_id})),work_name:t.Works.map((function(e){return e.work_name})),total:t.Works.map((function(e){return e.total})),send_to:t.Works.map((function(e){return e.send_to})),status:t.Works.map((function(e){return e.work_status})).length>0?t.Works.map((function(e){return e.work_status})):"not started",sum:0!==l(t.Works.map((function(e){return e.TimeSheetDTs.map((function(e){return e.total}))})))?function(e,t){var o=0;console.log("datamonday",t);for(var r=0;r<e.length;r++)console.log("int",e[r]),t.length>0&&t.map((function(e){console.log("test datamonday",c),e.mondayhd_name&&console.log("test datamonday",e.mondayhd_name)})),o+=parseInt(e[r]),console.log("int sum",o);return o}(t.Works.map((function(e){return e.total}),c))-l(t.Works.map((function(e){return e.TimeSheetDTs.map((function(e){return e.total}))}))):0,work_code:t.Works.map((function(e){return e.work_code})),total_ts:t.Works.map((function(e){return e.TimeSheetDTs.map((function(e){return e.total}))})),position:r,timesheets:t.Works.map((function(e){return e.TimeSheetDTs.map((function(e){return e.created_by}))}))};e.push(d)}})),e}),[a,n]),d=l.slice().sort((function(e,t){return new Date(e.created_date)-new Date(t.created_date)}));return d.forEach((function(e,t){e.autoNumber=t+1})),d},_=o(37762),y=(o(39783),function(e){var t=(0,i.useState)([]),o=(0,s.Z)(t,2),r=o[0],a=o[1],n=(0,i.useState)([]),c=(0,s.Z)(n,2),l=c[0],d=c[1];return console.log("v",e),(0,i.useEffect)((function(){a(e.position),d(e)}),[e]),console.log("data in subbb",r),console.log("data in work",l),(0,i.useMemo)((function(){var e=[];return r&&r.map((function(t,o){var a=function(e,o,r){var a=function(e,o){var r=[];if(e.length>0){var a=e.map((function(e){return JSON.parse(e)}));if(a.length>0)for(var n=0;n<a.length;n++)if(a[n].length>0)for(var s=0;s<a[n].length;s++)for(var i=0;i<o.length;i++){var c=a[n][s]===o[i];c&&(console.log("ihere i ngai1",a[n][s]),console.log("ihere i ngai2",o[i]),console.log("profile",c),console.log("ihere i ngai",n),r.push(n))}else for(var l=0;l<t.profile.length;l++){var d=a[n]===t.profile[l];d&&(console.log("profile",d),r.push(n))}return r}}(e,o),n=0;if(a&&a.length>0){var s,i=(0,_.Z)(a);try{for(i.s();!(s=i.n()).done;){var c=s.value,d=null===r||void 0===r?void 0:r.map((function(e){return JSON.parse(e)}));d&&void 0!==d&&d[c].length>1?n+=l.total[c]/d[c].length:n+=l.total[c]||0}}catch(u){i.e(u)}finally{i.f()}}return n},n=function(e,o){var r=function(e,o){var r=[];if(e.length>0){if(e.length>0)for(var a=0;a<e.length;a++)if(e[a].length>0)for(var n=0;n<e[a].length;n++)for(var s=0;s<o.length;s++){console.log("sendto",e[a]);var i=e[a][n]===o[s];i&&(console.log("ihere i ngai1",e[a][n]),console.log("ihere i ngai2",o[s]),console.log("profile 1",i),console.log("ihere i ngai",a),r.push(a))}else for(var c=0;c<t.profile.length;c++){var l=e[a]===t.profile[c];l&&(console.log("profile",l),r.push(a))}return console.log("is count",r),r}}(e,o),a=0;if(console.log("iValues",r),r&&r.length>0){var n,s=(0,_.Z)(r);try{for(s.s();!(n=s.n()).done;){var i=n.value;a+=parseInt(l.total_ts[i])||0,console.log("total",a)}}catch(c){s.e(c)}finally{s.f()}}return a};if(r.length>0){var s={position_code:t.position_code,position_name:t.position_name,manday:a(l.send_to,t.profile,l.send_to),actual:n(l.timesheets,t.profile),total:0===n(l.timesheets,t.profile)?0:a(l.send_to,t.profile)-n(l.timesheets,t.profile)};e.push(s),console.log("row",s)}})),e}),[r])}),S=o(76650),b=(o(94044),o(38443)),w=o(30686).useTheme,D=function(e,t,o){w();return[{Header:"PositionID",accessor:"Position_id",disableSortBy:!0,hidden:!0},{Header:"Position Code",accessor:"position_code",disableSortBy:!0,truncate:10,width:"10%"},{Header:"Position Name",accessor:"position_name",truncate:20,disableSortBy:!0},{Header:"Manday (hours)",accessor:"manday",disableSortBy:!0},{Header:"Actual (hours)",accessor:"actual",disableSortBy:!0},{Header:"Total (hour)",accessor:"total",disableSortBy:!0},{Header:"Start Date",accessor:"start_date",disableSortBy:!0,hidden:!0},{Header:"Finish Date",accessor:"finish_date",disableSortBy:!0,hidden:!0},{Header:"Go Live",accessor:"due_date",hidden:!0},{Header:"CreateDate",accessor:"created_date",disableSortBy:!0,hidden:!0},{Header:"Is Active",accessor:"is_active",disableSortBy:!0,hidden:!0},{Header:"Is Deleted",accessor:"is_deleted",disableSortBy:!0,hidden:!0}]},Z=o(46417),k=function(e){var t=e.DatafromIndex,o=((0,c.Z)(),y(t)),r=(0,i.useState)(null),a=(0,s.Z)(r,2),n=a[0],l=a[1],d=(0,i.useState)(!1),u=(0,s.Z)(d,2),f=u[0],h=u[1],g=(0,i.useState)(null),m=(0,s.Z)(g,2),v=m[0],_=m[1],b=function(){h(!f),n&&f&&l(null)},w=D(b,l,(function(e){l(null),h(!1),_(e)}),v);return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)("div",{style:{width:"100%",border:"1px solid #ccc",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.1)",borderRadius:"10px"},children:(0,Z.jsx)(p.Z,{children:(0,Z.jsx)(S.Z,{columns:w,data:o,handleAdd:b,getHeaderProps:function(e){return e.getSortByToggleProps()}})})})})},x=o(76142),B=o(42832),H=o(30686).useTheme,j=function(e,t,o){H();return[{Header:"No",accessor:"autoNumber",className:"cell-right",width:"5%",disableSortBy:!0},{Header:"ProjectId",accessor:"project_id",disableSortBy:!0,hidden:!0},{Header:"Project Code",accessor:"project_code",disableSortBy:!0,truncate:10,width:"10%"},{Header:"Project Name",accessor:"project_name",truncate:20,disableSortBy:!0},{Header:"Group Id",accessor:"group_id",disableSortBy:!0,hidden:!0},{Header:"Group",accessor:"group_name",disableSortBy:!0,hidden:!0},{Header:"Start Date",accessor:"start_date",disableSortBy:!0},{Header:"Finish Date",accessor:"finish_date",disableSortBy:!0},{Header:"Go Live",accessor:"due_date",Filter:x.K8,filter:x.mN},{Header:"Status",accessor:"status",disableSortBy:!0},{Header:"CreateDate",accessor:"created_date",disableSortBy:!0,hidden:!0},{Header:"Is Active",accessor:"is_active",disableSortBy:!0,hidden:!0},{Header:"Is Deleted",accessor:"is_deleted",disableSortBy:!0,hidden:!0},{Header:"WorkID",accessor:"work_id",disableSortBy:!0,hidden:!0},{Header:"Work Name",accessor:"work_name",disableSortBy:!0,hidden:!0},{Header:"Work Code",accessor:"work_code",disableSortBy:!0,hidden:!0},{Header:"Work send",accessor:"send_to",disableSortBy:!0,hidden:!0},{Header:"Work total",accessor:"total",disableSortBy:!0,hidden:!0},{Header:"SUM (hours)",accessor:"sum",disableSortBy:!0},{Header:"SUM (hours)",accessor:"position_name",disableSortBy:!0,hidden:!0},{Header:"position",accessor:"position",disableSortBy:!0,hidden:!0},{Header:"total timesheet",accessor:"total_ts",disableSortBy:!0,hidden:!0},{Header:"timesheets",accessor:"timesheets",disableSortBy:!0,hidden:!0},{Header:"Actions",className:"cell-center",width:"15%",disableSortBy:!0,Cell:function(e){var t=e.row,o=t.values,r=(t.isExpanded,t.toggleRowExpanded,(0,i.useState)(null)),a=(0,s.Z)(r,2);a[0],a[1];console.log("data values",o);return(0,Z.jsx)(B.Z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:0,children:(0,Z.jsx)(b.Z,{row:t})})}}]},C=o(43430),M=o(84897),W=(o(5242),function(){(0,c.Z)();var e=(0,i.useState)(null),t=(0,s.Z)(e,2),o=t[0],p=t[1],g=(0,i.useState)(!1),m=(0,s.Z)(g,2),_=m[0],y=m[1],S=(0,i.useState)(),b=(0,s.Z)(S,2),w=b[0],D=b[1],x=(0,i.useState)(),B=(0,s.Z)(x,2),H=B[0],W=B[1],P=(0,i.useState)(),E=(0,s.Z)(P,2),A=E[0],R=E[1],Y=(0,i.useState)(),N=(0,s.Z)(Y,2),T=N[0],I=N[1],F=v(H,w,A,T),G=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(){var t,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.Z.report.fetchUser();case 3:t=e.sent,o=t.data,t.isStatus&&D(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(){var t,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.Z.report.fetchReport();case 3:t=e.sent,o=t.data,t.isStatus&&W(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(){var t,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.Z.report.fetchTimesheet();case 3:t=e.sent,o=t.data,t.isStatus&&R(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(){var t,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.Z.report.fetchMonday();case 3:t=e.sent,o=t.data,t.isStatus&&I(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();console.log("data in report ",F),(0,i.useEffect)((function(){G(),V(),L(),O()}),[]),console.log("fetchData data in report ",w),console.log("project data in report ",H);var U=function(){y(!_),o&&_&&p(null),De(!0),De(!we)},J=(0,i.useState)(F),K=(0,s.Z)(J,2),X=K[0],q=K[1],z=new Date,Q=new Date(z);Q.setMonth(Q.getMonth()-1);var $=(0,i.useState)(Q),ee=(0,s.Z)($,2),te=ee[0],oe=ee[1],re=(0,i.useState)(z),ae=(0,s.Z)(re,2),ne=ae[0],se=ae[1],ie=function(){console.log("handleDateRangeChange",te,ne);(0,d.Z)(te,"dd-MM-yyyy"),(0,d.Z)(ne,"dd-MM-yyyy");var e=F.filter((function(e){var t=e.due_date.split("-"),o=t[1]+"-"+t[0]+"-"+t[2],r=new Date(o);return console.log("itemDate",r),function(e,t,o){console.log("checkDateRange",e,t,o);var r=e.getDate(),a=e.getMonth()+1,n=e.getFullYear(),s=t.getDate(),i=t.getMonth()+1,c=t.getFullYear(),l=o.getDate(),d=o.getMonth()+1,u=o.getFullYear();if(console.log("itemDueYear",o,u,n,c),u>=n&&u<=c)if(console.log("hello"),a!==i){if(d===a){if(l>=r)return console.log("itemDue in startDay",l),!0}else if(d===i){if(l<=s)return console.log("itemDue in endDay",l),!0}else if(d>a&&d<i)return console.log("itemDueMonth",d,a,i),!0}else if(a===i&&d>=a&&d<=i&&l>=r&&l<=s)return console.log("itemDue in startMonthendMonth",l),!0;return!1}(te,ne,r)}));console.log("formattedValueEnd filteredData",e),q(e)},ce=(0,i.useState)(te),le=(0,s.Z)(ce,2),de=le[0],ue=le[1],fe=(0,i.useState)(ne),he=(0,s.Z)(fe,2),pe=he[0],ge=he[1];(0,i.useEffect)((function(){console.log("filteredData",X),F&&(0!==X.length&&te===de&&ne===pe||ie()),te!==de&&ue(te),ne!==pe&&ge(ne)}),[X,te,ne]);var me=(0,i.useState)([]),ve=(0,s.Z)(me,2),_e=(ve[0],ve[1]),ye=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(){var t,o,r,n,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new u.Workbook,o=t.addWorksheet("Report"),r=(0,d.Z)(te,"dd-MM-yyyy"),n=(0,d.Z)(ne,"dd-MM-yyyy"),h.P6.book_new(),h.P6.json_to_sheet([]),{fill:{fgColor:{rgb:"ADD8E6"}}},o.getCell("A1").value="Report",o.getCell("A2").value="Date",o.getCell("B2").value=r,o.getCell("C2").value=n,s=["Project Code","Project Name","Duedate","Status","Sum (hrs)"],o.addRow([]),s.forEach((function(e){o.getCell("".concat(String.fromCharCode(65+s.indexOf(e)),"3")).value=e})),X.forEach((function(e,t){var r=[e.project_code,e.project_name,e.due_date,e.status,e.sum];console.log("index index",t),o.addRow(r),_e(e),o.addRow([""].concat(["\u0e23\u0e2b\u0e31\u0e2a\u0e15\u0e33\u0e41\u0e2b\u0e19\u0e48\u0e07","\u0e0a\u0e37\u0e48\u0e2d\u0e15\u0e33\u0e41\u0e2b\u0e19\u0e48\u0e07","Manday (hrs)","Actual (hrs)","Total (hrs)"])),o.lastRow.eachCell((function(e,t){1!==t&&(e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ADD8E6"}})})),console.log("subData",subData)})),o.getRow(3).eachCell((function(e){e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ADD8E6"}}})),o.columns.forEach((function(e){e.width=15})),e.next=20,t.xlsx.writeBuffer().then((function(e){(0,f.saveAs)(new Blob([e]),"Project Report (".concat(r," - ").concat(n,").xlsx"))}));case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Se=(0,i.useState)(!1),be=(0,s.Z)(Se,2),we=be[0],De=be[1],Ze=j(U,p,(function(e){handleDelete(e,G,"project")})),ke=(0,i.useCallback)((function(e){var t=e.row;return(0,Z.jsx)(k,{DatafromIndex:F[t.id]})}),[F]);console.log("handleDateRangeChange filteredData",X);var xe={columns:Ze,data:X,fetchData:w,renderRowSubComponent:ke,getHeaderProps:function(e){return e.getSortByToggleProps()},handleAdd:function(){return ye()},valueStart:te,valueEnd:ne,setValueStart:oe,setValueEnd:se,nameCreateButton:"Project",sortColumn:"created_date",fixColumnR:"action",fixColumnL:"autoNumber"};return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsxs)("div",{children:[(0,Z.jsx)("div",{style:{overflowX:"auto",maxWidth:"100%"},children:(0,Z.jsx)(C.Z,(0,r.Z)({},xe))}),(0,Z.jsx)(l.Z,{maxWidth:"lg",fullWidth:!0,open:we,PaperProps:{sx:{borderRadius:"10px"}}})]})})})}}]);