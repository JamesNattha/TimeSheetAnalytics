"use strict";(self.webpackChunkmantis_material_react=self.webpackChunkmantis_material_react||[]).push([[4089],{64089:function(e,t,o){o.r(t),o.d(t,{default:function(){return M}});var r=o(1413),a=o(74165),n=o(15861),s=o(29439),i=o(47313),c=o(19860),d=o(94469),l=o(89600),u=o(48737),f=o(73842),h=(o(18654),o(70816)),p=o.n(h),g=function(e,t,o){var r=e,a=t,n=o;console.log("raw data",r),console.log("datais in group",a);var s=(0,i.useMemo)((function(){var e=[];return r&&r.forEach((function(t,o){var s=[],i=[];Array.isArray(a)&&a.forEach((function(e,t){console.log("group",e.User.username);var o={position_code:e.User.username,position_name:"".concat(e.User.first_name," ").concat(e.User.last_name),profile:e.User.user_id};s.push(o)})),console.log("positionrows",s),Array.isArray(n)&&n.forEach((function(e,t){var o={total:e.total,timesheet_user:e.created_by,timesheetworkid:e.work_id};i.push(o)})),console.log("timesheetrows",i);var c=function(e){for(var t=0,o=0;o<e.length;o++)console.log("int",e[o]),t+=parseInt(e[o]),console.log("int sum",t);return isNaN(t)?0:t};if(r.length>0){var d={project_id:t.project_id,client_id:t.client_id,project_code:t.project_code,project_name:t.project_name,created_date:t.created_date,start_date:p()(t.start_date).format("DD-MM-YYYY"),finish_date:p()(t.finish_date).format("DD-MM-YYYY"),due_date:p()(t.due_date).format("DD-MM-YYYY"),is_active:t.is_active,is_deleted:t.is_deleted,work_id:t.Works.map((function(e){return e.work_id})),work_name:t.Works.map((function(e){return e.work_name})),total:t.Works.map((function(e){return e.total})),send_to:t.Works.map((function(e){return e.send_to})),status:t.Works.map((function(e){return e.work_status})).length>0?t.Works.map((function(e){return e.work_status})):"not started",sum:0!==c(t.Works.map((function(e){return e.TimeSheetDTs.map((function(e){return e.total}))})))?function(e){for(var t=0,o=0;o<e.length;o++)console.log("int",e[o]),t+=parseInt(e[o]),console.log("int sum",t);return t}(t.Works.map((function(e){return e.total})))-c(t.Works.map((function(e){return e.TimeSheetDTs.map((function(e){return e.total}))}))):0,work_code:t.Works.map((function(e){return e.work_code})),total_ts:t.Works.map((function(e){return e.TimeSheetDTs.map((function(e){return e.total}))})),position:s,timesheets:t.Works.map((function(e){return e.TimeSheetDTs.map((function(e){return e.created_by}))}))};e.push(d)}})),e}),[r,a]),c=s.slice().sort((function(e,t){return new Date(e.created_date)-new Date(t.created_date)}));return c.forEach((function(e,t){e.autoNumber=t+1})),c},m=o(76650),_=o(37762),v=(o(39783),function(e){var t=(0,i.useState)([]),o=(0,s.Z)(t,2),r=o[0],a=o[1],n=(0,i.useState)([]),c=(0,s.Z)(n,2),d=c[0],l=c[1];return console.log("DatafromIndex",e),(0,i.useEffect)((function(){a(e.position),l(e)}),[e]),console.log("data in subbb",r),console.log("data in work",d),(0,i.useMemo)((function(){var e=[];return r&&r.map((function(t,o){var a=function(e,o,r){var a=function(e,o){var r=[];if(e.length>0){var a=e.map((function(e){return JSON.parse(e)}));if(a.length>0)for(var n=0;n<a.length;n++)if(a[n].length>0)for(var s=0;s<a[n].length;s++)for(var i=0;i<o.length;i++){var c=a[n][s]===o[i];c&&(console.log("ihere i ngai1",a[n][s]),console.log("ihere i ngai2",o[i]),console.log("profile",c),console.log("ihere i ngai",n),r.push(n))}else for(var d=0;d<t.profile.length;d++){var l=a[n]===t.profile[d];l&&(console.log("profile",l),r.push(n))}return r}}(e,o),n=0;if(a&&a.length>0){var s,i=(0,_.Z)(a);try{for(i.s();!(s=i.n()).done;){var c=s.value,l=null===r||void 0===r?void 0:r.map((function(e){return JSON.parse(e)}));l&&void 0!==l&&l[c].length>1?n+=d.total[c]/l[c].length:n+=d.total[c]||0}}catch(u){i.e(u)}finally{i.f()}}return n},n=function(e,o){var r=function(e,o){var r=[];if(e.length>0){if(e.length>0)for(var a=0;a<e.length;a++)if(e[a].length>0)for(var n=0;n<e[a].length;n++)for(var s=0;s<o.length;s++){console.log("sendto",e[a]);var i=e[a][n]===o[s];i&&(console.log("ihere i ngai1",e[a][n]),console.log("ihere i ngai2",o[s]),console.log("profile 1",i),console.log("ihere i ngai",a),r.push(a))}else for(var c=0;c<t.profile.length;c++){var d=e[a]===t.profile[c];d&&(console.log("profile",d),r.push(a))}return console.log("is count",r),r}}(e,o),a=0;if(console.log("iValues",r),r&&r.length>0){var n,s=(0,_.Z)(r);try{for(s.s();!(n=s.n()).done;){var i=n.value;a+=parseInt(d.total_ts[i])||0,console.log("total",a)}}catch(c){s.e(c)}finally{s.f()}}return a};if(r.length>0){var s={position_code:t.position_code,position_name:t.position_name,manday:a(d.send_to,t.profile,d.send_to),actual:n(d.timesheets,t.profile),total:0===n(d.timesheets,t.profile)?0:a(d.send_to,t.profile)-n(d.timesheets,t.profile)};e.push(s),console.log("row",s)}})),e}),[r])}),y=(o(94044),o(38443)),S=o(30686).useTheme,b=function(e,t,o){S();return[{Header:"PositionID",accessor:"Position_id",disableSortBy:!0,hidden:!0},{Header:"Position Code",accessor:"position_code",disableSortBy:!0,truncate:10,width:"10%"},{Header:"Position Name",accessor:"position_name",truncate:20,disableSortBy:!0},{Header:"Manday (hours)",accessor:"manday",disableSortBy:!0},{Header:"Actual (hours)",accessor:"actual",disableSortBy:!0},{Header:"Total (hour)",accessor:"total",disableSortBy:!0},{Header:"Start Date",accessor:"start_date",disableSortBy:!0,hidden:!0},{Header:"Finish Date",accessor:"finish_date",disableSortBy:!0,hidden:!0},{Header:"Go Live",accessor:"due_date",hidden:!0},{Header:"CreateDate",accessor:"created_date",disableSortBy:!0,hidden:!0},{Header:"Is Active",accessor:"is_active",disableSortBy:!0,hidden:!0},{Header:"Is Deleted",accessor:"is_deleted",disableSortBy:!0,hidden:!0}]},w=o(46417),D=function(e){var t=e.DatafromIndex,o=((0,c.Z)(),v(t)),r=(0,i.useState)(null),a=(0,s.Z)(r,2),n=a[0],d=a[1],l=(0,i.useState)(!1),u=(0,s.Z)(l,2),h=u[0],p=u[1],g=(0,i.useState)(null),_=(0,s.Z)(g,2),y=_[0],S=_[1],D=function(){p(!h),n&&h&&d(null)},k=b(D,d,(function(e){d(null),p(!1),S(e)}),y);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)("div",{style:{width:"100%",border:"1px solid #ccc",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.1)",borderRadius:"10px"},children:(0,w.jsx)(f.Z,{children:(0,w.jsx)(m.Z,{columns:k,data:o,handleAdd:D,getHeaderProps:function(e){return e.getSortByToggleProps()}})})})})},k=o(76142),Z=o(42832),x=o(30686).useTheme,H=function(e,t,o){x();return[{Header:"No",accessor:"autoNumber",className:"cell-right",width:"5%",disableSortBy:!0},{Header:"ProjectId",accessor:"project_id",disableSortBy:!0,hidden:!0},{Header:"Project Code",accessor:"project_code",disableSortBy:!0,truncate:10,width:"10%"},{Header:"Project Name",accessor:"project_name",truncate:20,disableSortBy:!0},{Header:"Group Id",accessor:"group_id",disableSortBy:!0,hidden:!0},{Header:"Group",accessor:"group_name",disableSortBy:!0,hidden:!0},{Header:"Start Date",accessor:"start_date",disableSortBy:!0},{Header:"Finish Date",accessor:"finish_date",disableSortBy:!0},{Header:"Go Live",accessor:"due_date",Filter:k.K8,filter:k.mN},{Header:"Status",accessor:"status",disableSortBy:!0},{Header:"CreateDate",accessor:"created_date",disableSortBy:!0,hidden:!0},{Header:"Is Active",accessor:"is_active",disableSortBy:!0,hidden:!0},{Header:"Is Deleted",accessor:"is_deleted",disableSortBy:!0,hidden:!0},{Header:"WorkID",accessor:"work_id",disableSortBy:!0,hidden:!0},{Header:"Work Name",accessor:"work_name",disableSortBy:!0,hidden:!0},{Header:"Work Code",accessor:"work_code",disableSortBy:!0,hidden:!0},{Header:"Work send",accessor:"send_to",disableSortBy:!0,hidden:!0},{Header:"Work total",accessor:"total",disableSortBy:!0,hidden:!0},{Header:"SUM (hours)",accessor:"sum",disableSortBy:!0},{Header:"SUM (hours)",accessor:"position_name",disableSortBy:!0,hidden:!0},{Header:"position",accessor:"position",disableSortBy:!0,hidden:!0},{Header:"total timesheet",accessor:"total_ts",disableSortBy:!0,hidden:!0},{Header:"timesheets",accessor:"timesheets",disableSortBy:!0,hidden:!0},{Header:"Actions",className:"cell-center",width:"15%",disableSortBy:!0,Cell:function(e){var t=e.row,o=t.values,r=(t.isExpanded,t.toggleRowExpanded,(0,i.useState)(null)),a=(0,s.Z)(r,2);a[0],a[1];console.log("data values",o);return(0,w.jsx)(Z.Z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:0,children:(0,w.jsx)(y.Z,{row:t})})}}]},B=o(43430),j=o(84897),M=(o(5242),function(){(0,c.Z)();var e=(0,i.useState)(null),t=(0,s.Z)(e,2),o=t[0],f=t[1],h=(0,i.useState)(!1),p=(0,s.Z)(h,2),m=p[0],_=p[1],v=(0,i.useState)(),y=(0,s.Z)(v,2),S=y[0],b=y[1],k=(0,i.useState)(),Z=(0,s.Z)(k,2),x=Z[0],M=Z[1],P=(0,i.useState)(),C=(0,s.Z)(P,2),W=C[0],N=C[1],Y=g(x,S,W),I=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(){var t,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.Z.report.fetchUserByGroup();case 3:t=e.sent,o=t.data,t.isStatus&&b(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(){var t,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.Z.report.fetchProjectGroup();case 3:t=e.sent,o=t.data,t.isStatus&&M(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(){var t,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.Z.report.fetchTimesheet();case 3:t=e.sent,o=t.data,t.isStatus&&N(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();console.log("data in report ",Y),(0,i.useEffect)((function(){I(),T(),E()}),[]),console.log("fetchData data in report ",S),console.log("project data in report ",x);var A=function(){_(!m),o&&m&&f(null),fe(!0),fe(!ue)},R=(0,i.useState)(Y),F=(0,s.Z)(R,2),U=F[0],G=F[1],V=new Date,L=new Date(V);L.setMonth(L.getMonth()-1);var J=(0,i.useState)(L),O=(0,s.Z)(J,2),K=O[0],X=O[1],q=(0,i.useState)(V),z=(0,s.Z)(q,2),Q=z[0],$=z[1],ee=function(){console.log("test useEffect"),console.log("handleDateRangeChange",K,Q);(0,l.Z)(K,"dd-MM-yyyy"),(0,l.Z)(Q,"dd-MM-yyyy");var e=Y.filter((function(e){var t=e.due_date.split("-"),o=t[1]+"-"+t[0]+"-"+t[2],r=new Date(o);return console.log("itemDate",r),function(e,t,o){console.log("checkDateRange",e,t,o);var r=e.getDate(),a=e.getMonth()+1,n=e.getFullYear(),s=t.getDate(),i=t.getMonth()+1,c=t.getFullYear(),d=o.getDate(),l=o.getMonth()+1,u=o.getFullYear();if(console.log("itemDueYear",o,u,n,c),u>=n&&u<=c)if(console.log("hello"),a!==i){if(l===a){if(d>=r)return console.log("itemDue in startDay",d),!0}else if(l===i){if(d<=s)return console.log("itemDue in endDay",d),!0}else if(l>a&&l<i)return console.log("itemDueMonth",l,a,i),!0}else if(a===i&&l>=a&&l<=i&&d>=r&&d<=s)return console.log("itemDue in startMonthendMonth",d),!0;return!1}(K,Q,r)}));console.log("formattedValueEnd filteredData",e),G(e)},te=(0,i.useState)(K),oe=(0,s.Z)(te,2),re=oe[0],ae=oe[1],ne=(0,i.useState)(Q),se=(0,s.Z)(ne,2),ie=se[0],ce=se[1];(0,i.useEffect)((function(){console.log("filteredData",U),Y&&(0!==U.length&&K===re&&Q===ie||(K!==re?(ee(),ae(K)):Q!==ie&&(ee(),ce(Q))))}),[U,K,Q]);var de=(0,i.useState)(!1),le=(0,s.Z)(de,2),ue=le[0],fe=le[1],he=H(A,f,(function(e){handleDelete(e,I,"project")})),pe=(0,i.useCallback)((function(e){var t=e.row;return(0,w.jsx)(D,{DatafromIndex:Y[t.id]})}),[Y]);console.log("handleDateRangeChange filteredData",U);var ge={columns:he,data:U,fetchData:S,renderRowSubComponent:pe,getHeaderProps:function(e){return e.getSortByToggleProps()},handleAdd:function(){return function(){var e=[["Position Code","Position Name","Mandays(hrs)","Actual (hrs)","Sum (hrs)"]],t=(0,l.Z)(K,"dd-MM-yyyy"),o=(0,l.Z)(Q,"dd-MM-yyyy"),r=u.P6.book_new(),a=u.P6.json_to_sheet([]);a["!cols"]=[{width:15},{width:15},{width:20},{width:20},{width:10},{width:15},{width:15},{width:15}],u.P6.sheet_add_aoa(a,[["Project Code","Project Name","Duedate","Status","Sum (hrs)"]]);var n=U.map((function(t){var o=[t.project_code,t.project_name,t.due_date,t.status,t.sum];return t.position_code>0&&o.push.apply(o,e),o}));u.P6.sheet_add_json(a,n,{origin:"A2",skipHeader:!0}),u.P6.book_append_sheet(r,a,"Report"),(0,u.NC)(r,"Project Report (".concat(t," - ").concat(o,").xlsx"))}()},valueStart:K,valueEnd:Q,setValueStart:X,setValueEnd:$,nameCreateButton:"Project",sortColumn:"created_date",fixColumnR:"action",fixColumnL:"autoNumber"};return(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{style:{overflowX:"auto",maxWidth:"100%"},children:(0,w.jsx)(B.Z,(0,r.Z)({},ge))}),(0,w.jsx)(d.Z,{maxWidth:"lg",fullWidth:!0,open:ue,PaperProps:{sx:{borderRadius:"10px"}}})]})})})}}]);